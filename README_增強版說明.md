# ABCD策略當沖版 - 增強版多模式交易系統

## 🚀 新功能概述

本增強版ABCD策略系統提供了完整的多模式交易解決方案，從模擬測試到實盤交易，從回測分析到策略優化，一應俱全。

## 📋 運行模式選單

### 1. 即時交易模式 (連接永豐金API - 模擬)
- **功能**: 連接永豐金API進行模擬交易
- **特色**: 
  - 真實API連接但不執行實際下單
  - 即時價格監控和ABCD信號生成
  - 完整的風險管理和時間控制
  - 支援調試模式顯示詳細分析

### 2. 回測模式 (使用CSV檔案)
- **功能**: 使用歷史數據進行策略回測
- **特色**:
  - 自動識別CSV檔案格式和欄位
  - 支援多種編碼格式 (UTF-8, Big5, GB2312等)
  - 完整的回測報告生成
  - 權益曲線和交易記錄分析
  - 支援圖表輸出和結果保存

### 3. 實盤交易模式 (真實下單) 🔴
- **功能**: 執行真實的期貨交易
- **安全措施**:
  - 二次確認機制
  - API連接驗證
  - 保證金檢查
  - 緊急停止功能
  - 強制平倉保護

### 4. 策略優化模式
- **功能**: 自動化參數調優
- **優化範圍**:
  - RSI週期 (10-20)
  - MA快慢線週期 (10-80)
  - 布林通道週期 (15-30)
  - ADX閾值 (20-35)
  - 信號強度閾值 (2-4)
  - 止損止利比例
- **優化等級**:
  - 快速優化: 較少參數組合，適合初步測試
  - 標準優化: 平衡速度與精度
  - 深度優化: 全面參數搜索，耗時較長但結果更精確

### 5. 測試調試功能
- **功能**: 全面的系統測試和調試
- **測試項目**:
  - 數據載入功能測試
  - ABCD技術指標計算驗證
  - 信號生成邏輯測試
  - 參數驗證和合理性檢查
  - 時間管理功能測試
  - 詳細條件分析

## 🔧 核心技術指標 (ABCD策略)

### A條件: RSI相對強弱指標
- 檢測超買超賣狀態
- 識別價格反轉機會
- 動態閾值調整

### B條件: 移動平均線組合
- 快線MA20 vs 慢線MA60
- 多空趨勢判斷
- 差距閾值確認

### C條件: 布林通道價格位置
- 價格在通道中的相對位置
- 超買超賣區域識別
- 突破機會捕捉

### D條件: ADX趨勢強度指標
- 趨勢強度量化
- 方向指標(+DI/-DI)分析
- 成交量確認

## 🛡️ 風險管理機制

### 不留倉策略
- **強制平倉時間**:
  - 日盤: 13:20 (收盤前10分鐘)
  - 夜盤: 23:50 (收盤前10分鐘)
- **禁止開倉時間**:
  - 13:15-15:05 (日盤收盤至夜盤開盤)
  - 23:45-08:50 (夜盤收盤至日盤開盤)

### 交易限制
- 每日最大交易次數: 3筆
- 信號間隔: 30分鐘
- 連續虧損限制: 2次
- 持倉超時: 4小時

### 止損止利
- 止損比例: 0.5% (可調整)
- 止利比例: 2.5% (可調整)
- 移動止利: 獲利150點後啟動，距離40點

## 📊 調試模式功能

### 詳細信號分析
- ABCD四個條件的即時狀態
- 每個條件的滿足情況 (✓/✗)
- 技術指標數值顯示
- 信號強度評分

### 進階調試信息
- 5分鐘間隔狀態報告
- 持倉損益即時監控
- 移動止利狀態追蹤
- 風險管理觸發提醒

## 📈 回測報告功能

### 基本績效指標
- 總報酬率和年化報酬率
- 勝率和獲利因子
- 最大回撤分析
- 平均持倉時間

### 詳細交易分析
- 多空交易分別統計
- 交易原因分類
- 移動止利使用率
- 強制平倉比例

### 圖表輸出
- 權益曲線圖
- 價格和交易點標記
- 回撤分析圖
- 獲利分布直方圖

## 🎯 策略優化報告

### 參數敏感度分析
- 各參數與報酬率相關性
- 最佳參數組合排名
- 參數穩定性評估

### 優化結果輸出
- JSON格式詳細結果
- 最佳參數配置文件
- 驗證回測報告

## 🔧 安裝和設置

### 環境要求
```bash
pip install shioaji pandas numpy talib python-dotenv matplotlib seaborn
```

### API設定
在`.env`檔案中設定永豐金API資訊：
```env
API_KEY=your_api_key_here
SECRET_KEY=your_secret_key_here
CA_CERT_PATH=your_cert_path_here
CA_PASSWORD=your_cert_password_here

# 交易參數
MAX_POSITION=1
STOP_LOSS_PCT=0.005
TAKE_PROFIT_PCT=0.025
```

## 🚀 使用方法

### 快速開始
1. 下載 `ABCD策略當沖版_增強版.py`
2. 設定 `.env` 檔案
3. 運行程式：
   ```python
   python ABCD策略當沖版_增強版.py
   ```
4. 選擇運行模式 (1-5)
5. 選擇是否啟用調試模式

### 回測使用
1. 準備CSV檔案 (包含OHLCV數據)
2. 選擇模式2 (回測模式)
3. 輸入CSV檔案路徑
4. 查看回測報告
5. 選擇是否保存結果和生成圖表

### 策略優化
1. 準備充足的歷史數據
2. 選擇模式4 (策略優化模式)
3. 選擇優化等級 (快速/標準/深度)
4. 等待優化完成
5. 查看最佳參數組合

### 實盤交易 ⚠️
1. 確保API設定正確
2. 檢查保證金充足
3. 選擇模式3 (實盤交易模式)
4. 輸入 'YES' 二次確認
5. 監控交易執行
6. 使用 Ctrl+C 安全停止

## ⚠️ 重要提醒

### 風險聲明
- 本程式僅供學習和研究使用
- 實盤交易存在虧損風險
- 請在充分了解風險後使用
- 建議先進行充分的回測和模擬

### 使用建議
1. **新手用戶**: 建議從調試模式和回測開始
2. **進階用戶**: 可使用策略優化功能調整參數
3. **專業用戶**: 可進入模擬模式進行實時測試
4. **實盤交易**: 必須充分測試後再小資金試行

### 技術支援
- 確保Ta-Lib正確安裝
- 檢查網路連接穩定性
- 驗證API憑證有效性
- 監控系統資源使用

## 📝 更新日誌

### v2.0 (當前版本)
- ✅ 新增5種運行模式選擇
- ✅ 實現策略參數優化功能
- ✅ 增強調試模式和測試功能
- ✅ 完善實盤交易安全機制
- ✅ 優化回測報告和圖表輸出
- ✅ 改進CSV數據載入兼容性

### v1.0 (原版本)
- ABCD策略基本框架
- 不留倉機制
- 移動止利功能
- 基礎回測功能

## 🤝 貢獻和反饋

歡迎提出改進建議和報告問題！

## 📄 授權

本專案僅供學習和研究使用，請勿用於商業用途。
